services:
  fano-proxy:
    build:
      context: .
      dockerfile: Dockerfile.proxy
    container_name: fano-stt-proxy
    ports:
      - "8080:8080"
    environment:
      - PROXY_PORT=8080
      - FANO_URL=wss://ocbc-poc.fano.ai/speech/streaming-recognize
      - AUTH_TOKEN=${AUTH_TOKEN}
    restart: unless-stopped
    healthcheck:
      disable: true
    networks:
      - fano-network

  fano-stt-app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_WEBSOCKET_URL=${NEXT_PUBLIC_WEBSOCKET_URL}
    container_name: fano-stt-web
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - WEBSOCKET_URL=${WEBSOCKET_URL}
      - NEXT_PUBLIC_WEBSOCKET_URL=${NEXT_PUBLIC_WEBSOCKET_URL}
    depends_on:
      - fano-proxy
    restart: unless-stopped
    healthcheck:
      disable: true
    networks:
      - fano-network

networks:
  fano-network:
    driver: bridge
    name: fano-stt-network

volumes:
  node_modules_proxy:
  node_modules_app:
